{"hash":"4971f2bdf3a5022a419fa3a70720114982841feb","data":{"notes":{"title":"Setting up Amazon Neptune","content":"<p>This document will walk you through the process of setting up an Amazon Neptune database without any previous configuration. This guide will only be concerned with setting up Neptune.</p>\n<p>Note that it is <em>not possible</em> to connect to an Amazon Neptune database directly from your local machine. Instead, you must configure an EC2 instance to act as a bastion server:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 618 518' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-7bd2f28e89ca12d86e2d223537dc82be'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-7bd2f28e89ca12d86e2d223537dc82be)' width='618' height='518' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAA2CAYAAAB3Ep8CAAAACXBIWXMAAA3nAAAN5wGZFKomAAAL2klEQVRo3uVb%2b29b1R3nv9gkpgkJhsY2tInXYAiNSqAJaUwgmNjYtE0avzGmobUwSqFAX2ylLaykKUGjLWnSNo%2bWpM0bt3nHeTSJ7cR52Y4dv%2b049vXj%2bnFtf3a%2bx76u7VznQZuk2Y70zTm%2b5z7O%2bZzv%2b5zckU6nkU6nELuyD%2bEPfoJ4y4dIJ0RQYV3I9G8%2bZb6fqTey3EF/pCkVwv%2b4C%2bH3f4zw3h8h8tEOxLtOYqvKZoJwR8jrQPTTZyFWv8a4YD9iDXsRvfg2Ioef5L8DsRSWwjFG8U0hfyRRAMSGc4Cq9jRie%2b6G1H4Yqd4KJDuOQGr6AFLZL%2bHdfR/qurSoUttQPWBBtXphQ%2bncoBWne824MGRdxgkbJwKpEOYrXoX9yHOwH/s17EdfgP34y7AdeR5u1el8xtw0Efis04SAmNgcEaA/0SQQCgYRFDIUYhQR/EwPVCB67jVIRjWfPlEqKUFKpSElU7eUkuydRFS%2b7LdA2EwAEsnkso7kYBVCf/8WQrvvRnj/Q4ieeQWSVbuhg5EBIDHYVABS7COkgOqHF3B20IHegSHE//0MIhW/RbTuTURrdyJ84kUkPn4KEz0tODvsRs3gApfVm6WaIRuqBhYwZFrKDWrTAaDSpHGiacwGN/uu5fx7iO76NpKth5DsLIN05X1IX%2b1G/N174Tz6HOb9SVgWw4wit4QWfBF8qjLk5H5LAGjRuTDrFHg7PNWDhb2Pw75/B2z7noR1z8Owf/QrLLz9IHyq/2yIUjzPLIAvFN9aALTWAG%2bnGEWCAYRcFoiLDiRDS4j77BD9i%2btwZjKitZK3R/2prNyfZWLgC28xADpbhgNSqVTuhkAoAvXwdYzrJuFZ9GFKr4fD4YDH64XRZILRaILPt4SJyUl%2b3eVywW63Q5KSGauxgleXb%2bdvKwAyH8182OWwQdXRhuvDg/C6nWhraUZ7aws6r6owMjSIpsuNMJuMuPp1B4YG1bz/q4v1SKekZZNdyeXdCADW4kgVApAVgWgiCaMnDIM7BItPhFWQYGa1wRmA2RuGyROC0SXAthTlbZM3wmlhKYZ5Vs86g5lr7B3WJZFzweocYGE6IHZTABTHEErBVfH7bgCgvcEBmoUAnIEoglGJD8TPYgFBlBBizwaZyyAkMzUnNs5AJM7vI%2bLPMCKNHolLWSDDyyZTOLg0zjLnxxfNiN6ZHtO6AVgtgCoFRgEAervAL86wFVQqKXUlpEu7M2bx8nuM9gIew6pWQel9fABUpzJOWNWQAz6Pi7c/V3s4qOuJB4onH4vF4PF4OFG7FAgFAEzaMxwwx1g/9wBTiFyZBT0IH/oZ8wy/h9A7P%2bBhc2jnnYi2H8vcy1xkJbZLMDd31hVavhJ88pkVTzmnYPv09xD%2btQPJ489AVV0OMZUBdS0AFE8%2bIAjQ6nQYHRvjpJuYQDAYVHxGEQB5wHKyhA9ScCNy9GlE9j%2bMyKHHEPnwcYTf/SED4OMcAFAIncjPn3IEle0kVSEvf69U%2bQril96G%2bNlvWHR6DyTN5cx32XuTzFVfiYpXdWpqCmMaDZ84ATHO2mSlZmZmYLZYCkBQFIHpLMsWABBkABx5CuF9DyJ84KeMGx5DaM/3Ee34JCsfSSQSiaIBpTkHTDmE5X5AFrBE7ymIn/8O4ulX2LsfQqz%2bLYhnX0X09J/X5WrJpjsYCvEJ08SJNFptrqbrxBEOpzN3/4o6QAaABpL0OyAe/jnEfQ8gevARRA89CnHPvYi2fpQb6KlTp3DgwAFUVFTgxIkTKC8vRxmrDx75hLdlor6Kk%2bUQmJ6LXy3j8YZY9jwix36ByD%2bfQIwSMtV/Yx%2bNwcZ8isbGRqjVavT19RVQf38/uru74WQTohJik6dVlyddDIJMY%2bPjmJmd5YulrAMKRCA7PSkOz/GX4H33AXjefxTeDx6D8637EeivyfJTCtFolCscerEkEetKiMUT0Nv8/HcBJTJKLqhpR/DQE0jU7UTswuuIX3wLUtmz8FXv4v3zRgMqKyuhUqnQ3t5eQB0dHWhubsbCwkLmXrOZr7A86VIkg2Can1%2bLDmCR4tIS/EIQbqsZ9skRLJmnsGicgGA1rKqgKMSddoZKqS%2bQDbCdeh2Lr9%2bJwBt3IbDzO9DsegSC3bhux4fknDhgknmr1C5Fcj%2bBuqIO4AvPVqu%2bvh7Xrl7F9MwsRjU6NFxpRmNTC%2bouNaCtrRUtbBV8Pl9OFvM5R1aCK2V/qYy21sFacxBC52m0Ds8ha7h4rLCaEpTl2WAwsPG0oX9gAANMZKjuY2Iik3y9l4kPcZCLic4qShA5DvAy3z/g90MQAnAzf99mtcJus/E%2bigHi8biiSSIAZhQ4QO6n9zY0NKDp6260d6txrX8YtfUX2WTmCgBdySnKB9PMxGCAJs4mOTIygtHR0Vw9PDzM%2b4aGhvh3S5pBWQek1pmUVIr%2biv2AYgBIb1gsZiwQmefZqjhgMhr59bU4QqXcXDKFpCNopWnCpCxJaRY/q8gBSgPOL2amPIIB/5qB0WeBVRq4n3HVlStX0HTlMro6O9HV1QUVC6y0zGSt1RPMB4E4hogsA4nEGFOKVsats0zrz83N5foVHSE5FqC8AGVp3EIULkaeYIy1Y7AvRRBhzx08fBTtXf0IMlPu9ItwZ/tdgcL7iQhMCpCUYgEqcWYlaHDXtXqmlc1skJn2nMG47lhgLfsJpV3hvHA4LqVgZxOzsgjQxqI5alNt8YawxET9THUNekd08IppDpTcb80S/SaiPgKk1MDyf18aZ652dk%2bk5roLooR1xQJKk8tfbbld2hVelg9QNltU6uvqMDc7c1NxeeYasqFyGl/2mbGYDYe/6J5fdzB0izNCyiaLsjxUamtrmZKZztr51Dfe7LxtM0Jynq54sMnkDQCmp6eXpc9uJmNz2wGgyAHJ/xcOKPnR1DfSAVuVE/zGAJD3Zietn920kK2BmVkBL1Pqp6ouMCughTuc4jlCuZ/upWfyf5NVkLe8bnsOkPcF9PYgs91hrpXJpntZTW1XQAQZtUMsvFX1DoGsuysQyfbH4Q0W3k/XCBA5IbJtRECuFc1gQoBpRo%2bA08LawbV5ggyAZGobiYA84AJFRonG9qMQa3chefJ5JM7/lZ8kSQzX5JKbSjs/MkdtKwAmWJ0qktuUKED84k9I9J/hSVGx4mXEm/ZDrPpLLiWmlPaW37c9ALDeiAWWARAXIX72EsRPnuFnBeKdJxHefQ9ExgVpBQDyn/3f4ICIH9HaNzjLR8qeQ1x1HOG9968JAMovbDsdUAxAMh5F6MjTiOy5F%2bF37uOrH37zuwhf2LkGDhC2LwcgLzXubz4G97EX4C3/Izzlf4D74xcRHG3O5kRLA7CNdUA65%2bv7AwH0DY5gQj%2bFoeER6CYmodFNwuFZLHCJldJi248D7MKygIgCoUH1ADo62nnikXJuavZ7ZmZ61cTE9tMBBAD5PIkENLTLotVCp9NhcnKSJx3Hx8d5m/JuGo0Wer2eJx7l/HxxZnjbOULyOQHalzPMzWKgrzdzMKKtFTqtBlP6SX44oqO9DZcbG9Db3YWe7k6YjMo7xbrtogPkWICUlpn58LTXH06kEWNjoECYhkRDpNQV7d7Sdn48nampLyKBn/UlWopkzgtQUKTfbrEApbIpiCEQjO4gtCYn%2brUGXusYGVwCoyA/MTJhdvHAaczgwIzNx5%2bhJKjRHeJtiggpulQ6tXFbAdDKAJhQyAck4jHG%2bi04f66anwXq6%2bnGpfo6dHdeQxejxq8uYYKJRXdXJxeJ/t4e1NfVwpTd2FA6oaEUL9Bh6S0FoHHMwY/GKJVYVGRAxBEJh/jOkNfjhsftQlAQGAX4jlEoKEBgplII%2bGGeN0GMhNc1kC96zDx83jIAaFeoTGXEObYSlf0WfmaHE2PN6kEbqtRWXp8bsuP8sIMTtTllr8tEaW26tzL7/Nn89xURHZOlCRMHbNlZYToVRiUck/gq0LlhXz6FZIpxWsySrwRl%2boresQplco7ZQ1J9W8ABt1MhDpD/c2TDASDZrxu2oX7EhrotpvoRJj5sLOXXjCXziLe6/BdGXHeG5SG5VQAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"618\" alt=\"pwd\" data-srcset=\"/assets/static/vpc-ec2-diagram.45e738d.a4a54f8d89cd7d4a026cbb1252fcc99b.png 618w\" data-sizes=\"(max-width: 618px) 100vw, 618px\" data-src=\"/assets/static/vpc-ec2-diagram.45e738d.a4a54f8d89cd7d4a026cbb1252fcc99b.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/vpc-ec2-diagram.45e738d.a4a54f8d89cd7d4a026cbb1252fcc99b.png\" width=\"618\" alt=\"pwd\"></noscript></p>\n<p>Diagram taken from <a href=\"https://docs.aws.amazon.com/neptune/latest/userguide/security-vpc.html\" target rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<p>Fortunately, we will also be hosting our project on our EC2 instance. This simplifies our setup greatly.</p>\n<p>Sign into AWS here: <a href=\"https://www.awseducate.com/signin/SiteLogin\" target rel=\"nofollow noopener noreferrer\">https://www.awseducate.com/signin/SiteLogin</a></p>\n<h3 id=\"setting-up-your-ec2-instance\"><a href=\"#setting-up-your-ec2-instance\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting up your EC2 instance</h3>\n<p>If you already have an EC2 instance set up, you may partially or completely skip this section.</p>\n<ol>\n<li>Go to the AWS console. If you are logged into your AWS account, you can access it directly <a href=\"https://console.aws.amazon.com/console/home\" target rel=\"nofollow noopener noreferrer\">here</a>.</li>\n<li>Search \"EC2\" in the search bar and click on the \"EC2\" option in the dropdown. This should take you to the EC2 dashboard.</li>\n<li>On the right, click on \"Instances\" to view your instances. Then, click on the \"Launch instances\" to launch a new EC2 instance. Select Amazon Linux, then accept all default options.</li>\n<li>Launch your instance. You will be prompted to download and save a <code class=\"language-text\">.pem</code> file. This holds the credentials needed to connect to your EC2 instance. Keep this in a safe place.</li>\n<li>After you launch your instance, go back to the instances page and click on your newly created EC2 instance. Take note of this instance's <strong>VPC ID</strong>.</li>\n</ol>\n<h3 id=\"setting-up-your-neptune-database\"><a href=\"#setting-up-your-neptune-database\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting up your Neptune database</h3>\n<ol>\n<li>Go to the AWS console.</li>\n<li>Search \"Neptune\" in the search bar and click on the \"Neptune\" option in the dropdown. This should take you to Neptune's dashboard.</li>\n<li>Click on \"Create database.\" In the \"Connectivity\" section, ensure that the \"Virtual Private Cloud (VPC)\" option matches to your instance's <strong>VPC ID</strong>. Every other option can be kept default. You may choose a production database or a development database at your discretion. We recommend you use a development database first and set up a production database later.</li>\n<li>Create the database.</li>\n<li>After you create your database, go back to the Neptune dashboard and click on your newly created database cluster. Take note of the <strong>cluster endpoint</strong> (this should be a URL) and <strong>Port</strong> (default 8182).</li>\n</ol>\n<h3 id=\"sshing-into-your-ec2-instance\"><a href=\"#sshing-into-your-ec2-instance\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SSHing into your EC2 instance</h3>\n<p>Please follow the guide from the AWS docs: <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html\" target rel=\"nofollow noopener noreferrer\">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html</a></p>\n<p>If you having trouble connecting, make sure you are using the correct private key and logging in as the user <code class=\"language-text\">ec2-user</code> instead of <code class=\"language-text\">root</code>. If you are using PuTTY (Windows only), make sure you convert your <code class=\"language-text\">.pem</code> file to a <code class=\"language-text\">.ppk</code> file.</p>\n<h3 id=\"connecting-to-your-neptune-database\"><a href=\"#connecting-to-your-neptune-database\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Connecting to your Neptune database</h3>\n<ol>\n<li>SSH into your EC2 instance.</li>\n<li>\n<p>Follow the instructions in the AWS docs here: <a href=\"https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-console.html\" target rel=\"nofollow noopener noreferrer\">https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-console.html</a></p>\n<ul>\n<li>You may run into an issue when you try running the command <code class=\"language-text\">cp {@jre_path}/lib/security/cacerts /tmp/certs/cacerts</code>. If you are using a freshly provisioned EC2 instance, you can ignore this step.</li>\n<li>When you see <code class=\"language-text\">your-neptune-endpoint</code>, use your <strong>cluster endpoint</strong>.</li>\n</ul>\n</li>\n<li>The AWS docs provide the example query <code class=\"language-text\">g.V().limit(1)</code> in order to test your connection to the Neptune database. If you'd like, you can copy paste the following commands to populate your database with test data:</li>\n</ol>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">g.addV().property(&quot;uuid&quot;, 123456)\ng.addV().property(&quot;uuid&quot;, 654321)\ng.V().has(&quot;uuid&quot;, 123456).bothE(&quot;friends with&quot;).where(otherV().has(&quot;uuid&quot;, 654321)).count()\ng.addE(&quot;friends with&quot;).from(g.V().has(&quot;uuid&quot;, 123456)).to(g.V().has(&quot;uuid&quot;, 654321))\ng.V().has(&quot;uuid&quot;, 123456).bothE(&quot;friends with&quot;).where(otherV().has(&quot;uuid&quot;, 654321)).count()\ng.V().has(&quot;uuid&quot;, 654321).bothE(&quot;friends with&quot;).where(otherV().has(&quot;uuid&quot;, 123456)).count()\ng.V().count()</code></pre></div>\n<p>Lines 1-2: add two people with uuid <code class=\"language-text\">123456</code> and <code class=\"language-text\">654321</code>.</p>\n<p>Line 3: check if <code class=\"language-text\">123456</code> and <code class=\"language-text\">654321</code> are friends. Returns 1 if they are and 0 if they are not. Should return 0.</p>\n<p>Line 4: adds an edge between <code class=\"language-text\">123456</code> and <code class=\"language-text\">654321</code> to indicate that they are friends.</p>\n<p>Lines 5-6: check if <code class=\"language-text\">123456</code> and <code class=\"language-text\">654321</code> are friends. Returns 1 if they are and 0 if they are not. Both should return 1.</p>\n<p>Line 7: check how many people are in our database. Should be 2.</p>\n<p>You can then delete the test data by entering:</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">g.V().drop()</code></pre></div>\n<p>Exit the gremlin console by entering <code class=\"language-text\">:exit</code></p>\n<p>You may also make a HTTPS request to the Neptune database:</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -X POST -d &#39;{&quot;gremlin&quot;:&quot;&lt;GREMLIN_QUERY_HERE&gt;&quot;}&#39; https://NEPTUNE_CLUSTER_ENDPOINT:PORT/gremlin</code></pre></div>\n<p>You must call the HTTPS response through EC2. The HTTPS request will always fail if you execute it on your local machine.</p>\n","date":"2020-11-17"}},"context":{}}